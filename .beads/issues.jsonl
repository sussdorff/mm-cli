{"id":"mm-cli-0kt","title":"Add portfolio command for investment/depot data","description":"MoneyMoney has 'export portfolio' in its AppleScript API supporting asset class filtering. Add 'mm portfolio' command to view securities holdings, asset allocation, and investment performance. Requires new Portfolio/Security models.","status":"open","priority":3,"issue_type":"feature","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T15:01:02.885269+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T15:01:02.885269+01:00"}
{"id":"mm-cli-1b4","title":"Top customers analysis for cognovis income","description":"New 'mm analyze top-customers' command showing income grouped by counterparty name. Primarily for cognovis accounts to track revenue concentration and customer trends. Shows customer name, total income, transaction count, percentage of total, and optional period comparison. Filterable by --group (default cognovis).","status":"open","priority":2,"issue_type":"feature","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T18:02:05.623857+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T18:02:05.623857+01:00"}
{"id":"mm-cli-4du","title":"IBAN-based transfer detection for analysis commands","description":"Currently, transfers are detected by checking if a transaction's category falls under the Umbuchungen category tree. This works because MoneyMoney auto-categorizes same-group (same legal entity) transfers as 'Echte Umbuchung' and cross-group transfers get proper income/expense categories (e.g. Gehalt).\n\nHowever, a structural IBAN-based approach would be more robust: detect transfers by checking if the counterparty's IBAN matches one of the user's own accounts.\n\nKey concept: group = legal entity.\n- Same-group transfer (e.g. Privat→Privat): internal shuffle, exclude\n- Cross-group transfer (e.g. cognovis→Privat salary): real cashflow, keep\n\nImplementation:\n1. Add counterparty_iban field to Transaction model (from plist accountNumber field)\n2. Build own-IBAN set from accounts\n3. Match counterparty IBAN against own accounts\n4. Same-group → exclude, cross-group → keep\n5. Keep category-based detection as fallback (credit card settlements lack counterparty IBAN)\n\nThis also serves as validation for correct Umbuchungen categorization and catches uncategorized transfers.","status":"closed","priority":2,"issue_type":"feature","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T19:05:35.053256+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T21:22:48.60478+01:00","closed_at":"2026-01-26T21:22:48.60478+01:00","close_reason":"Implemented IBAN-based transfer detection. counterparty_iban field added to Transaction, filter_transfers rewritten with IBAN+group logic, all 5 analyze commands wired up. 7 new tests, live tested.","labels":["analysis","transfers"]}
{"id":"mm-cli-5vw","title":"Category spending analysis: budget vs actual, period comparison","description":"Add analysis commands for category spending: budget vs actual comparison (categories have budget fields), period-over-period comparison (this month vs last, this quarter vs last). Most valuable for Privat accounts where budget planning matters. Could be a new 'mm analyze' or 'mm spending' command.","notes":"## Implementierungsplan\n\nZiel: Neuer mm analyze spending Command: Kategorie-Spending, Budget-Vergleich, Periodenvergleich.\n\nAenderungen:\n1. models.py: Category um budget_period + budget_available erweitern. Neues SpendingAnalysis Dataclass.\n2. applescript.py: Budget-Parsing erweitern (period, available aus Dict).\n3. cli.py: analyze Subcommand-Gruppe + spending Command (--period, --compare, --account, --group, --type).\n4. analysis.py (NEU): resolve_period(), compute_spending() Logik.\n5. output.py: output_spending() mit Budget-Spalten, Compare-Spalte, Farbcodierung.\n\nPerioden: this-month, last-month, this-quarter, last-quarter, this-year. Auch --from/--to moeglich.\nBudget-Periodenumrechnung (Monat-\u003eQuartal etc.) als Folge-Ticket.\n\nDependencies: Braucht mm-cli-obm (Account-Gruppen) fuer --group Filter.\n\nVerifikation: mm analyze spending / --period last-month / --compare / --type expense / --group Privat / --format json","status":"closed","priority":2,"issue_type":"feature","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T15:00:50.497137+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T18:00:56.190622+01:00","closed_at":"2026-01-26T18:00:56.190622+01:00","close_reason":"Implemented: analyze spending command with budget comparison and period-over-period"}
{"id":"mm-cli-8oy","title":"Add --group filter to transactions command","description":"The transactions command currently supports --account but not --group filtering. Add --group option to filter transactions by account group (e.g. Privat, cognovis), consistent with the analyze commands.","status":"open","priority":2,"issue_type":"feature","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T18:59:43.098585+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T18:59:43.098585+01:00"}
{"id":"mm-cli-bee","title":"Expose additional MoneyMoney AppleScript functionality","description":"## Overview\nMoneyMoney provides extensive AppleScript automation beyond basic data retrieval. This ticket covers exposing all additional capabilities through the CLI.\n\n## Reference\nOfficial documentation: https://moneymoney.app/applescript/\n\n## Additional Commands to Implement\n\n### Portfolio Management\n#### `mm portfolio`\nExport securities holdings.\n- AppleScript: `export portfolio from account ... as \"plist\"`\n- Options:\n  - `--account` / `-a`: Specific account (optional, all if omitted)\n- Output: Security name, ISIN, quantity, value, performance\n\n### Bank Transfers\n#### `mm transfer`\nCreate a bank transfer.\n- AppleScript: `create bank transfer from account ... to ... iban ... amount ... purpose ...`\n- Arguments:\n  - `--from-account`: Source account\n  - `--to`: Recipient name\n  - `--iban`: Recipient IBAN\n  - `--amount`: Transfer amount\n  - `--purpose`: Transfer purpose/reference\n- Options:\n  - `--outbox`: Save to outbox without opening UI\n  - `--dry-run`: Show transfer details without creating\n\n#### `mm batch-transfer`\nImport SEPA-XML batch transfer.\n- AppleScript: `create batch transfer from POSIX file ...`\n- Arguments:\n  - `file`: Path to SEPA-XML file\n- Options:\n  - `--validate`: Validate XML without importing\n\n### Direct Debits\n#### `mm direct-debit`\nCreate a direct debit.\n- AppleScript: `create direct debit from account ... for ... iban ... amount ... purpose ... mandate reference ... mandate date ... scheduled date ...`\n- Arguments:\n  - `--from-account`: Creditor account\n  - `--for`: Debtor name\n  - `--iban`: Debtor IBAN\n  - `--amount`: Debit amount\n  - `--purpose`: Purpose text\n  - `--mandate-ref`: SEPA mandate reference\n  - `--mandate-date`: Mandate signature date (YYYY-MM-DD)\n  - `--scheduled-date`: Execution date (YYYY-MM-DD)\n- Options:\n  - `--outbox`: Save to outbox without opening UI\n\n#### `mm batch-direct-debit`\nImport SEPA-XML batch direct debit.\n- AppleScript: `create batch direct debit from POSIX file ...`\n- Arguments:\n  - `file`: Path to SEPA-XML file\n\n### Offline Account Management\n#### `mm add-transaction`\nAdd transaction to offline account.\n- AppleScript: `add transaction to account ... on date ... to ... amount ... purpose ... category ...`\n- Arguments:\n  - `--account`: Target offline account name\n  - `--date`: Transaction date (YYYY-MM-DD)\n  - `--to`: Payee/recipient name\n  - `--amount`: Transaction amount (negative for expenses)\n  - `--purpose`: Description/purpose\n  - `--category`: Category name (optional)\n\n### Transaction Management\n#### `mm set-checkmark`\nSet/unset transaction checkmark.\n- AppleScript: `set transaction id [ID] checkmark to \"on\"/\"off\"`\n- Arguments:\n  - `transaction_id`: Transaction ID\n  - `state`: on/off\n\n#### `mm set-comment`\nAdd/update transaction note.\n- AppleScript: `set transaction id [ID] comment to ...`\n- Arguments:\n  - `transaction_id`: Transaction ID\n  - `comment`: Note text\n\n### Export Enhancements\n#### `mm export`\nUnified export command with format options.\n- Subcommands:\n  - `mm export transactions --format csv/plist/json`\n  - `mm export accounts --format plist/json`\n  - `mm export categories --format plist/json`\n  - `mm export portfolio --format plist/json`\n\n## Implementation Notes\n\n### Safety Considerations\n- Transfer and direct debit commands should require `--confirm` flag or interactive confirmation\n- Add `--dry-run` to all write operations\n- Validate IBAN format before sending to AppleScript\n- Validate dates and amounts\n\n### Command Groups\nOrganize commands into logical groups:\n- `mm accounts` - Account operations\n- `mm transactions` - Transaction queries\n- `mm categories` - Category management\n- `mm transfers` - Transfer operations (transfer, batch-transfer)\n- `mm debits` - Direct debit operations (direct-debit, batch-direct-debit)\n- `mm portfolio` - Securities/portfolio\n\n## Acceptance Criteria\n- [ ] All additional AppleScript commands exposed via CLI\n- [ ] Safety confirmations for write operations\n- [ ] IBAN validation\n- [ ] Date format validation\n- [ ] SEPA-XML validation for batch imports\n- [ ] Comprehensive --help for all commands\n- [ ] Integration tests with MoneyMoney (manual verification)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T14:04:45.22783+01:00","created_by":"malte","updated_at":"2026-01-26T15:04:49.058892+01:00","closed_at":"2026-01-26T15:04:49.058892+01:00","close_reason":"Split into specific beads: mm-cli-0kt (portfolio), mm-cli-t41 (checkmark/comment), mm-cli-qpf (transfer). Direct debit, batch operations, and offline accounts dropped as not needed.","dependencies":[{"issue_id":"mm-cli-bee","depends_on_id":"mm-cli-ezy","type":"blocks","created_at":"2026-01-06T14:04:45.23055+01:00","created_by":"malte"}]}
{"id":"mm-cli-dyg","title":"Fix category hierarchy - categories export is flat, losing parent-child structure","description":"## Problem\nThe mm categories command returns all 106 categories as flat/root-level items with no parent information. MoneyMoney's export categories AppleScript returns a flat plist. However, transaction data contains full category paths with backslash separators (e.g. Malte\\Ausgaben\\Leben\\Ernährung), proving the hierarchy exists.\n\n## Root Cause  \nMoneyMoney's export categories plist has no children arrays. The _parse_category_tree() in applescript.py:228 handles children but there are none.\n\n## Solution\nReconstruct hierarchy from transaction category paths. Export transactions, collect unique category paths, build tree from backslash-separated paths. Map category UUIDs via categoryUuid field.\n\n## Impact\n- 106 categories shown flat with no hierarchy\n- Duplicate names (3x Sonstiges, 3x Nebenkosten, 2x Ausgaben) are indistinguishable\n- Cannot suggest proper categories for uncategorized transactions","status":"closed","priority":1,"issue_type":"bug","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T13:53:18.093472+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T14:01:09.47752+01:00","closed_at":"2026-01-26T14:01:09.47752+01:00","close_reason":"Closed"}
{"id":"mm-cli-ezy","title":"Implement core CLI commands for MoneyMoney interaction","description":"## Overview\nImplement the core CLI commands to interact with MoneyMoney macOS app via AppleScript. This is the foundation for all MoneyMoney data access.\n\n## Commands to Implement\n\n### 1. `mm accounts`\nList all accounts from MoneyMoney database.\n- AppleScript: `export accounts`\n- Returns: Account ID, name, balance, type, bank name\n- Output formats: table (default), json\n\n### 2. `mm transactions`\nList transactions with filtering options.\n- AppleScript: `export transactions from account ... from date ... to date ... as \"plist\"`\n- Options:\n  - `--account` / `-a`: Filter by account ID or name\n  - `--from` / `-f`: Start date (YYYY-MM-DD)\n  - `--to` / `-t`: End date (YYYY-MM-DD)  \n  - `--category` / `-c`: Filter by category\n  - `--uncategorized`: Show only uncategorized transactions\n- Output formats: table (default), json, csv\n\n### 3. `mm categories`\nList all categories from MoneyMoney.\n- AppleScript: `export categories`\n- Returns: Category UUID, name, parent category, type (income/expense)\n- Output formats: table (default), json\n\n### 4. `mm category-usage`\nShow categories sorted by transaction count.\n- Requires: transactions export + category mapping\n- Output: Category name, transaction count, total amount\n- Options:\n  - `--from` / `-f`: Start date\n  - `--to` / `-t`: End date\n  - `--limit` / `-n`: Top N categories\n\n### 5. `mm set-category`\nUpdate the category of a transaction.\n- AppleScript: `set transaction id [ID] category to [UUID]`\n- Arguments:\n  - `transaction_id`: Transaction ID (from plist export)\n  - `category`: Category name or UUID\n- Options:\n  - `--dry-run`: Show what would be changed without applying\n\n## Technical Implementation\n\n### AppleScript Module (`mm_cli/applescript.py`)\n- `run_applescript(script: str) -\u003e str`: Execute AppleScript via osascript\n- `export_accounts() -\u003e list[dict]`: Get all accounts\n- `export_transactions(...) -\u003e list[dict]`: Get transactions with filters\n- `export_categories() -\u003e list[dict]`: Get all categories\n- `set_transaction_category(tx_id: str, category_id: str) -\u003e bool`: Update category\n\n### Models (`mm_cli/models.py`)\n- `Account`: dataclass for account data\n- `Transaction`: dataclass for transaction data\n- `Category`: dataclass for category data\n\n### Output Formatting (`mm_cli/output.py`)\n- Rich tables for terminal output\n- JSON serialization\n- CSV export\n\n## Acceptance Criteria\n- [ ] All 5 commands implemented and working\n- [ ] Proper error handling for AppleScript failures\n- [ ] Rich formatted tables for human-readable output\n- [ ] JSON output option for machine processing\n- [ ] Unit tests with mocked AppleScript responses\n- [ ] `--help` documentation for all commands","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T14:04:05.745845+01:00","created_by":"malte","updated_at":"2026-01-06T14:14:32.841262+01:00","closed_at":"2026-01-06T14:14:32.841262+01:00","close_reason":"All 5 CLI commands implemented with full test coverage"}
{"id":"mm-cli-h6x","title":"Extend transaction filtering: amount range, sorting, checkmark status","description":"Add --min-amount, --max-amount, --sort (date|amount|name), --reverse, and --checkmark filter to the transactions command. Useful for budget analysis (Privat accounts) and reconciliation workflows.","status":"open","priority":3,"issue_type":"feature","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T15:00:38.505068+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T15:00:38.505068+01:00"}
{"id":"mm-cli-iqv","title":"Recurring transaction detection","description":"New 'mm analyze recurring' command that detects recurring transactions by merchant name pattern, similar amounts, and monthly cadence. Shows subscriptions, standing orders, insurance payments. Helps find forgotten subscriptions. Groups by normalized merchant name, shows frequency, average amount, last occurrence, and total annual cost.","status":"open","priority":2,"issue_type":"feature","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T18:02:01.874841+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T18:02:01.874841+01:00"}
{"id":"mm-cli-kr0","title":"Cashflow analysis: income vs expenses over time","description":"New 'mm analyze cashflow' command showing monthly or quarterly income vs expenses trend over a configurable period (default last 6 months). Table output with month rows, income/expense/net columns. Optionally filterable by --group. Useful for spotting accumulation vs burn trends across all account groups.","status":"open","priority":2,"issue_type":"feature","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T18:01:47.833794+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T18:01:47.833794+01:00"}
{"id":"mm-cli-n4w","title":"Improve test coverage for untested functions","description":"Several implemented functions lack tests: set_transaction_checkmark(), set_transaction_comment(), _extract_balance(), export command with various formats, suggest-rules CLI command integration test, edge cases (empty results, null values, unusual currencies). Add tests to improve maintainability.","status":"open","priority":3,"issue_type":"task","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T15:00:56.967816+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T15:00:56.967816+01:00"}
{"id":"mm-cli-obm","title":"Add account groups/hierarchy to accounts command","description":"## Problem\nmm accounts skips account groups (applescript.py:190). MoneyMoney organizes accounts into groups (Haushalt, Privat, cognovis, Aufgelöst, FlyHH) but this structure is lost.\n\n## Requirements\n- Show account groups in table output (indented or grouped)\n- Add --include-groups or --show-groups flag  \n- Add --active flag to filter out zero-balance/closed accounts (Aufgelöst group)\n- JSON output should include group name as field\n- Consider --group filter flag\n\n## Known Groups\nHaushalt: DKB Haushalt\nPrivat: Haus, Tagesgeld, Privat, Flatex, AMEX Malte, MLP Kreditkarte\ncognovis: Postbank, Fyrst Base, CapTrader, AMEX Business Gold, PayPal\nAufgelöst: Penta, Smartbroker, old cards\nFlyHH: Fidor, old Postbank, old cards, AirBnB, Instandhaltung","notes":"## Implementierungsplan\n\nZiel: mm accounts zeigt Account-Gruppen. Default: flache Liste + Group-Spalte. --hierarchy fuer gruppierte Anzeige mit Section Headers/Subtotals.\n\nAenderungen:\n1. applescript.py: Gruppen-Tracking statt skip. Gruppenname an Child-Accounts propagieren. Bugfix: Account.group war bool statt str.\n2. cli.py: Neue Flags --hierarchy, --active (filtert Aufgeloest), --group TEXT (wiederholbar).\n3. output.py: Default-Tabelle mit Group-Spalte. Hierarchy-Mode: Section Headers (bold) + Subtotals pro Gruppe.\n\nReihenfolge: Dieses Ticket ZUERST (Dependency fuer mm-cli-5vw Spending --group Filter).\n\nVerifikation: mm accounts / --hierarchy / --active / --group Privat / --group Privat --group Haushalt / --format json","status":"closed","priority":2,"issue_type":"task","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T13:53:24.1056+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T18:00:58.041251+01:00","closed_at":"2026-01-26T18:00:58.041251+01:00","close_reason":"Implemented: account groups with --hierarchy, --active, --group flags"}
{"id":"mm-cli-qpf","title":"Add transfer command for bank transfers via MoneyMoney","description":"Add 'mm transfer' command to create SEPA bank transfers through MoneyMoney's AppleScript API. Use case: quickly pay scanned invoices from the CLI. Parameters: --from-account, --to (recipient), --iban, --amount, --purpose. Safety: require --confirm flag or interactive confirmation, add --dry-run, validate IBAN format. AppleScript: 'create bank transfer from account ... to ... iban ... amount ... purpose ...'. Supports --outbox to queue without opening UI.","status":"open","priority":3,"issue_type":"feature","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T15:04:43.199986+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T15:04:43.199986+01:00"}
{"id":"mm-cli-s94","title":"Top merchants analysis by spend","description":"New 'mm analyze merchants' command showing top N merchants/counterparties by total spend. Groups by transaction name (normalized) instead of category. Answers 'where does the money actually go?' before categorization. Supports --type income/expense, --group, --period filters. Complements existing category-usage command.","status":"open","priority":2,"issue_type":"feature","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T18:02:03.280437+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T18:02:03.280437+01:00"}
{"id":"mm-cli-t41","title":"Add CLI commands for set-checkmark and set-comment","description":"The AppleScript functions set_transaction_checkmark() and set_transaction_comment() exist in applescript.py but have no CLI wrappers. Add 'mm set-checkmark \u003ctx-id\u003e [on|off]' and 'mm set-comment \u003ctx-id\u003e \u003ctext\u003e' commands. Useful for reconciliation marking and annotation workflows.","status":"open","priority":3,"issue_type":"feature","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T15:00:44.576379+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T15:00:44.576379+01:00"}
{"id":"mm-cli-ty3","title":"Balance history / trend per account","description":"New 'mm analyze balance-history' command showing account balance trajectory over time. Approximates historical balances by working backwards from current balance using transactions. Shows monthly balance snapshots per account or per group. Useful for liquidity trend visualization. Supports --group, --account, --months filters.","status":"open","priority":2,"issue_type":"feature","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T18:02:07.271488+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T18:02:07.271488+01:00"}
{"id":"mm-cli-wk8","title":"Add suggest-rules command for MoneyMoney auto-categorization analysis","description":"## Context\nMoneyMoney has NO AppleScript API for reading or managing rules as separate entities (confirmed via .sdef scripting dictionary). HOWEVER, the export categories plist DOES include a 'rules' field on each category containing the MoneyMoney rule text. This is now parsed and available in mm-cli via the Category.rules field.\n\n## What's Already Available (after mm-cli-dyg fix)\n- Category.rules: The MoneyMoney rule text for each category\n- Category.path: Full hierarchical path (e.g. Malte\\Ausgaben\\Leben\\Ernährung)\n- Category.indentation: Nesting level\n- Category.group: Whether it's a group/folder\n- mm categories --format json: Full data including rules\n\n## Feature: mm suggest-rules\nAnalyze transaction data to suggest NEW MoneyMoney rules:\n1. Find uncategorized transactions, match against patterns from categorized ones\n2. Suggest rules based on recurring payee patterns\n3. Compare against existing rules to avoid duplicates\n4. Detect PayPal + direct merchant duplicates (same amount, same date)\n\n## Output Example\nPattern                        | Category      | Matches | Existing Rule?\nName contains Apple.com.Bill   | Subscriptions | 4       | Partial (Apple.com/Bill in Sonstige Unterhaltung)\nName contains Versicherung     | Versicherung  | 4       | No\n\n## Implementation\n- Use export_transactions() for transaction data\n- Use export_categories() for existing rules\n- Build payee-\u003ecategory mapping from categorized transactions\n- Compare suggested rules against existing Category.rules\n- Apply fuzzy matching (normalize PayPal names, strip location suffixes)\n- Use historical data for better matching","status":"closed","priority":2,"issue_type":"feature","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T13:53:30.084484+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T14:09:51.107943+01:00","closed_at":"2026-01-26T14:09:51.107943+01:00","close_reason":"Closed","dependencies":[{"issue_id":"mm-cli-wk8","depends_on_id":"mm-cli-dyg","type":"blocks","created_at":"2026-01-26T13:54:06.612269+01:00","created_by":"Malte Sussdorff"}]}
