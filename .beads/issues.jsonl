{"id":"mm-cli-bee","title":"Expose additional MoneyMoney AppleScript functionality","description":"## Overview\nMoneyMoney provides extensive AppleScript automation beyond basic data retrieval. This ticket covers exposing all additional capabilities through the CLI.\n\n## Reference\nOfficial documentation: https://moneymoney.app/applescript/\n\n## Additional Commands to Implement\n\n### Portfolio Management\n#### `mm portfolio`\nExport securities holdings.\n- AppleScript: `export portfolio from account ... as \"plist\"`\n- Options:\n  - `--account` / `-a`: Specific account (optional, all if omitted)\n- Output: Security name, ISIN, quantity, value, performance\n\n### Bank Transfers\n#### `mm transfer`\nCreate a bank transfer.\n- AppleScript: `create bank transfer from account ... to ... iban ... amount ... purpose ...`\n- Arguments:\n  - `--from-account`: Source account\n  - `--to`: Recipient name\n  - `--iban`: Recipient IBAN\n  - `--amount`: Transfer amount\n  - `--purpose`: Transfer purpose/reference\n- Options:\n  - `--outbox`: Save to outbox without opening UI\n  - `--dry-run`: Show transfer details without creating\n\n#### `mm batch-transfer`\nImport SEPA-XML batch transfer.\n- AppleScript: `create batch transfer from POSIX file ...`\n- Arguments:\n  - `file`: Path to SEPA-XML file\n- Options:\n  - `--validate`: Validate XML without importing\n\n### Direct Debits\n#### `mm direct-debit`\nCreate a direct debit.\n- AppleScript: `create direct debit from account ... for ... iban ... amount ... purpose ... mandate reference ... mandate date ... scheduled date ...`\n- Arguments:\n  - `--from-account`: Creditor account\n  - `--for`: Debtor name\n  - `--iban`: Debtor IBAN\n  - `--amount`: Debit amount\n  - `--purpose`: Purpose text\n  - `--mandate-ref`: SEPA mandate reference\n  - `--mandate-date`: Mandate signature date (YYYY-MM-DD)\n  - `--scheduled-date`: Execution date (YYYY-MM-DD)\n- Options:\n  - `--outbox`: Save to outbox without opening UI\n\n#### `mm batch-direct-debit`\nImport SEPA-XML batch direct debit.\n- AppleScript: `create batch direct debit from POSIX file ...`\n- Arguments:\n  - `file`: Path to SEPA-XML file\n\n### Offline Account Management\n#### `mm add-transaction`\nAdd transaction to offline account.\n- AppleScript: `add transaction to account ... on date ... to ... amount ... purpose ... category ...`\n- Arguments:\n  - `--account`: Target offline account name\n  - `--date`: Transaction date (YYYY-MM-DD)\n  - `--to`: Payee/recipient name\n  - `--amount`: Transaction amount (negative for expenses)\n  - `--purpose`: Description/purpose\n  - `--category`: Category name (optional)\n\n### Transaction Management\n#### `mm set-checkmark`\nSet/unset transaction checkmark.\n- AppleScript: `set transaction id [ID] checkmark to \"on\"/\"off\"`\n- Arguments:\n  - `transaction_id`: Transaction ID\n  - `state`: on/off\n\n#### `mm set-comment`\nAdd/update transaction note.\n- AppleScript: `set transaction id [ID] comment to ...`\n- Arguments:\n  - `transaction_id`: Transaction ID\n  - `comment`: Note text\n\n### Export Enhancements\n#### `mm export`\nUnified export command with format options.\n- Subcommands:\n  - `mm export transactions --format csv/plist/json`\n  - `mm export accounts --format plist/json`\n  - `mm export categories --format plist/json`\n  - `mm export portfolio --format plist/json`\n\n## Implementation Notes\n\n### Safety Considerations\n- Transfer and direct debit commands should require `--confirm` flag or interactive confirmation\n- Add `--dry-run` to all write operations\n- Validate IBAN format before sending to AppleScript\n- Validate dates and amounts\n\n### Command Groups\nOrganize commands into logical groups:\n- `mm accounts` - Account operations\n- `mm transactions` - Transaction queries\n- `mm categories` - Category management\n- `mm transfers` - Transfer operations (transfer, batch-transfer)\n- `mm debits` - Direct debit operations (direct-debit, batch-direct-debit)\n- `mm portfolio` - Securities/portfolio\n\n## Acceptance Criteria\n- [ ] All additional AppleScript commands exposed via CLI\n- [ ] Safety confirmations for write operations\n- [ ] IBAN validation\n- [ ] Date format validation\n- [ ] SEPA-XML validation for batch imports\n- [ ] Comprehensive --help for all commands\n- [ ] Integration tests with MoneyMoney (manual verification)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-06T14:04:45.22783+01:00","created_by":"malte","updated_at":"2026-01-06T14:04:45.22783+01:00","dependencies":[{"issue_id":"mm-cli-bee","depends_on_id":"mm-cli-ezy","type":"blocks","created_at":"2026-01-06T14:04:45.23055+01:00","created_by":"malte"}]}
{"id":"mm-cli-ezy","title":"Implement core CLI commands for MoneyMoney interaction","description":"## Overview\nImplement the core CLI commands to interact with MoneyMoney macOS app via AppleScript. This is the foundation for all MoneyMoney data access.\n\n## Commands to Implement\n\n### 1. `mm accounts`\nList all accounts from MoneyMoney database.\n- AppleScript: `export accounts`\n- Returns: Account ID, name, balance, type, bank name\n- Output formats: table (default), json\n\n### 2. `mm transactions`\nList transactions with filtering options.\n- AppleScript: `export transactions from account ... from date ... to date ... as \"plist\"`\n- Options:\n  - `--account` / `-a`: Filter by account ID or name\n  - `--from` / `-f`: Start date (YYYY-MM-DD)\n  - `--to` / `-t`: End date (YYYY-MM-DD)  \n  - `--category` / `-c`: Filter by category\n  - `--uncategorized`: Show only uncategorized transactions\n- Output formats: table (default), json, csv\n\n### 3. `mm categories`\nList all categories from MoneyMoney.\n- AppleScript: `export categories`\n- Returns: Category UUID, name, parent category, type (income/expense)\n- Output formats: table (default), json\n\n### 4. `mm category-usage`\nShow categories sorted by transaction count.\n- Requires: transactions export + category mapping\n- Output: Category name, transaction count, total amount\n- Options:\n  - `--from` / `-f`: Start date\n  - `--to` / `-t`: End date\n  - `--limit` / `-n`: Top N categories\n\n### 5. `mm set-category`\nUpdate the category of a transaction.\n- AppleScript: `set transaction id [ID] category to [UUID]`\n- Arguments:\n  - `transaction_id`: Transaction ID (from plist export)\n  - `category`: Category name or UUID\n- Options:\n  - `--dry-run`: Show what would be changed without applying\n\n## Technical Implementation\n\n### AppleScript Module (`mm_cli/applescript.py`)\n- `run_applescript(script: str) -\u003e str`: Execute AppleScript via osascript\n- `export_accounts() -\u003e list[dict]`: Get all accounts\n- `export_transactions(...) -\u003e list[dict]`: Get transactions with filters\n- `export_categories() -\u003e list[dict]`: Get all categories\n- `set_transaction_category(tx_id: str, category_id: str) -\u003e bool`: Update category\n\n### Models (`mm_cli/models.py`)\n- `Account`: dataclass for account data\n- `Transaction`: dataclass for transaction data\n- `Category`: dataclass for category data\n\n### Output Formatting (`mm_cli/output.py`)\n- Rich tables for terminal output\n- JSON serialization\n- CSV export\n\n## Acceptance Criteria\n- [ ] All 5 commands implemented and working\n- [ ] Proper error handling for AppleScript failures\n- [ ] Rich formatted tables for human-readable output\n- [ ] JSON output option for machine processing\n- [ ] Unit tests with mocked AppleScript responses\n- [ ] `--help` documentation for all commands","status":"in_progress","priority":2,"issue_type":"task","created_at":"2026-01-06T14:04:05.745845+01:00","created_by":"malte","updated_at":"2026-01-06T14:08:09.783172+01:00"}
