{"id":"mm-cli-0kt","title":"Add portfolio command for investment/depot data","description":"MoneyMoney has 'export portfolio' in its AppleScript API supporting asset class filtering. Add 'mm portfolio' command to view securities holdings, asset allocation, and investment performance. Requires new Portfolio/Security models.","status":"closed","priority":3,"issue_type":"feature","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T15:01:02.885269+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T21:41:05.951102+01:00","closed_at":"2026-01-26T21:41:05.951102+01:00","close_reason":"Implemented: portfolio command with Security/Portfolio models, plist parsing, Rich table output, and 12 tests."}
{"id":"mm-cli-1b4","title":"Top customers analysis for cognovis income","description":"New 'mm analyze top-customers' command showing income grouped by counterparty name. Primarily for cognovis accounts to track revenue concentration and customer trends. Shows customer name, total income, transaction count, percentage of total, and optional period comparison. Filterable by --group (default cognovis).","status":"closed","priority":2,"issue_type":"feature","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T18:02:05.623857+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T21:32:43.52222+01:00","closed_at":"2026-01-26T21:32:43.52222+01:00","close_reason":"Already fully implemented: CLI command, analysis function, output function, and tests all present."}
{"id":"mm-cli-4du","title":"IBAN-based transfer detection for analysis commands","description":"Currently, transfers are detected by checking if a transaction's category falls under the Umbuchungen category tree. This works because MoneyMoney auto-categorizes same-group (same legal entity) transfers as 'Echte Umbuchung' and cross-group transfers get proper income/expense categories (e.g. Gehalt).\n\nHowever, a structural IBAN-based approach would be more robust: detect transfers by checking if the counterparty's IBAN matches one of the user's own accounts.\n\nKey concept: group = legal entity.\n- Same-group transfer (e.g. Privatâ†’Privat): internal shuffle, exclude\n- Cross-group transfer (e.g. cognovisâ†’Privat salary): real cashflow, keep\n\nImplementation:\n1. Add counterparty_iban field to Transaction model (from plist accountNumber field)\n2. Build own-IBAN set from accounts\n3. Match counterparty IBAN against own accounts\n4. Same-group â†’ exclude, cross-group â†’ keep\n5. Keep category-based detection as fallback (credit card settlements lack counterparty IBAN)\n\nThis also serves as validation for correct Umbuchungen categorization and catches uncategorized transfers.","status":"closed","priority":2,"issue_type":"feature","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T19:05:35.053256+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T21:22:48.60478+01:00","closed_at":"2026-01-26T21:22:48.60478+01:00","close_reason":"Implemented IBAN-based transfer detection. counterparty_iban field added to Transaction, filter_transfers rewritten with IBAN+group logic, all 5 analyze commands wired up. 7 new tests, live tested.","labels":["analysis","transfers"]}
{"id":"mm-cli-5vw","title":"Category spending analysis: budget vs actual, period comparison","description":"Add analysis commands for category spending: budget vs actual comparison (categories have budget fields), period-over-period comparison (this month vs last, this quarter vs last). Most valuable for Privat accounts where budget planning matters. Could be a new 'mm analyze' or 'mm spending' command.","notes":"## Implementierungsplan\n\nZiel: Neuer mm analyze spending Command: Kategorie-Spending, Budget-Vergleich, Periodenvergleich.\n\nAenderungen:\n1. models.py: Category um budget_period + budget_available erweitern. Neues SpendingAnalysis Dataclass.\n2. applescript.py: Budget-Parsing erweitern (period, available aus Dict).\n3. cli.py: analyze Subcommand-Gruppe + spending Command (--period, --compare, --account, --group, --type).\n4. analysis.py (NEU): resolve_period(), compute_spending() Logik.\n5. output.py: output_spending() mit Budget-Spalten, Compare-Spalte, Farbcodierung.\n\nPerioden: this-month, last-month, this-quarter, last-quarter, this-year. Auch --from/--to moeglich.\nBudget-Periodenumrechnung (Monat-\u003eQuartal etc.) als Folge-Ticket.\n\nDependencies: Braucht mm-cli-obm (Account-Gruppen) fuer --group Filter.\n\nVerifikation: mm analyze spending / --period last-month / --compare / --type expense / --group Privat / --format json","status":"closed","priority":2,"issue_type":"feature","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T15:00:50.497137+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T18:00:56.190622+01:00","closed_at":"2026-01-26T18:00:56.190622+01:00","close_reason":"Implemented: analyze spending command with budget comparison and period-over-period"}
{"id":"mm-cli-8oy","title":"Add --group filter to transactions command","description":"The transactions command currently supports --account but not --group filtering. Add --group option to filter transactions by account group (e.g. Privat, cognovis), consistent with the analyze commands.","status":"closed","priority":2,"issue_type":"feature","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T18:59:43.098585+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T21:31:51.644148+01:00","closed_at":"2026-01-26T21:31:51.644148+01:00","close_reason":"Closed"}
{"id":"mm-cli-bee","title":"Expose additional MoneyMoney AppleScript functionality","description":"## Overview\nMoneyMoney provides extensive AppleScript automation beyond basic data retrieval. This ticket covers exposing all additional capabilities through the CLI.\n\n## Reference\nOfficial documentation: https://moneymoney.app/applescript/\n\n## Additional Commands to Implement\n\n### Portfolio Management\n#### `mm portfolio`\nExport securities holdings.\n- AppleScript: `export portfolio from account ... as \"plist\"`\n- Options:\n  - `--account` / `-a`: Specific account (optional, all if omitted)\n- Output: Security name, ISIN, quantity, value, performance\n\n### Bank Transfers\n#### `mm transfer`\nCreate a bank transfer.\n- AppleScript: `create bank transfer from account ... to ... iban ... amount ... purpose ...`\n- Arguments:\n  - `--from-account`: Source account\n  - `--to`: Recipient name\n  - `--iban`: Recipient IBAN\n  - `--amount`: Transfer amount\n  - `--purpose`: Transfer purpose/reference\n- Options:\n  - `--outbox`: Save to outbox without opening UI\n  - `--dry-run`: Show transfer details without creating\n\n#### `mm batch-transfer`\nImport SEPA-XML batch transfer.\n- AppleScript: `create batch transfer from POSIX file ...`\n- Arguments:\n  - `file`: Path to SEPA-XML file\n- Options:\n  - `--validate`: Validate XML without importing\n\n### Direct Debits\n#### `mm direct-debit`\nCreate a direct debit.\n- AppleScript: `create direct debit from account ... for ... iban ... amount ... purpose ... mandate reference ... mandate date ... scheduled date ...`\n- Arguments:\n  - `--from-account`: Creditor account\n  - `--for`: Debtor name\n  - `--iban`: Debtor IBAN\n  - `--amount`: Debit amount\n  - `--purpose`: Purpose text\n  - `--mandate-ref`: SEPA mandate reference\n  - `--mandate-date`: Mandate signature date (YYYY-MM-DD)\n  - `--scheduled-date`: Execution date (YYYY-MM-DD)\n- Options:\n  - `--outbox`: Save to outbox without opening UI\n\n#### `mm batch-direct-debit`\nImport SEPA-XML batch direct debit.\n- AppleScript: `create batch direct debit from POSIX file ...`\n- Arguments:\n  - `file`: Path to SEPA-XML file\n\n### Offline Account Management\n#### `mm add-transaction`\nAdd transaction to offline account.\n- AppleScript: `add transaction to account ... on date ... to ... amount ... purpose ... category ...`\n- Arguments:\n  - `--account`: Target offline account name\n  - `--date`: Transaction date (YYYY-MM-DD)\n  - `--to`: Payee/recipient name\n  - `--amount`: Transaction amount (negative for expenses)\n  - `--purpose`: Description/purpose\n  - `--category`: Category name (optional)\n\n### Transaction Management\n#### `mm set-checkmark`\nSet/unset transaction checkmark.\n- AppleScript: `set transaction id [ID] checkmark to \"on\"/\"off\"`\n- Arguments:\n  - `transaction_id`: Transaction ID\n  - `state`: on/off\n\n#### `mm set-comment`\nAdd/update transaction note.\n- AppleScript: `set transaction id [ID] comment to ...`\n- Arguments:\n  - `transaction_id`: Transaction ID\n  - `comment`: Note text\n\n### Export Enhancements\n#### `mm export`\nUnified export command with format options.\n- Subcommands:\n  - `mm export transactions --format csv/plist/json`\n  - `mm export accounts --format plist/json`\n  - `mm export categories --format plist/json`\n  - `mm export portfolio --format plist/json`\n\n## Implementation Notes\n\n### Safety Considerations\n- Transfer and direct debit commands should require `--confirm` flag or interactive confirmation\n- Add `--dry-run` to all write operations\n- Validate IBAN format before sending to AppleScript\n- Validate dates and amounts\n\n### Command Groups\nOrganize commands into logical groups:\n- `mm accounts` - Account operations\n- `mm transactions` - Transaction queries\n- `mm categories` - Category management\n- `mm transfers` - Transfer operations (transfer, batch-transfer)\n- `mm debits` - Direct debit operations (direct-debit, batch-direct-debit)\n- `mm portfolio` - Securities/portfolio\n\n## Acceptance Criteria\n- [ ] All additional AppleScript commands exposed via CLI\n- [ ] Safety confirmations for write operations\n- [ ] IBAN validation\n- [ ] Date format validation\n- [ ] SEPA-XML validation for batch imports\n- [ ] Comprehensive --help for all commands\n- [ ] Integration tests with MoneyMoney (manual verification)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T14:04:45.22783+01:00","created_by":"malte","updated_at":"2026-01-26T15:04:49.058892+01:00","closed_at":"2026-01-26T15:04:49.058892+01:00","close_reason":"Split into specific beads: mm-cli-0kt (portfolio), mm-cli-t41 (checkmark/comment), mm-cli-qpf (transfer). Direct debit, batch operations, and offline accounts dropped as not needed.","dependencies":[{"issue_id":"mm-cli-bee","depends_on_id":"mm-cli-ezy","type":"blocks","created_at":"2026-01-06T14:04:45.23055+01:00","created_by":"malte"}]}
{"id":"mm-cli-dt0","title":"Add --days option and default date range for transactions command","description":"## Problem\n\n`mm transactions` without `--from`/`--to` fails with AppleScript error: 'Einige Parameter fehlen fÃ¼r export transactions' (-1701). MoneyMoney requires a date range but the CLI has no default.\n\nThis also affects `--group` and other filters when used without explicit dates.\n\n## Solution\n\n1. Add a `--days` / `-d` option (integer, default 14) that sets the date range to 'today minus N days'\n2. When neither `--from`/`--to` nor `--days` is provided, default to last 14 days\n3. `--days` should be mutually exclusive with `--from`/`--to` (or: `--days` sets `--from` if not explicitly provided)\n4. Update help text to explain the default behavior\n\n## Discovered during\nManual testing of mm-cli-gk5 (mm-cli-8oy group filter tests)","status":"closed","priority":1,"issue_type":"bug","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T21:58:38.902695+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T22:15:33.542757+01:00","closed_at":"2026-01-26T22:15:33.542757+01:00","close_reason":"Closed"}
{"id":"mm-cli-dyg","title":"Fix category hierarchy - categories export is flat, losing parent-child structure","description":"## Problem\nThe mm categories command returns all 106 categories as flat/root-level items with no parent information. MoneyMoney's export categories AppleScript returns a flat plist. However, transaction data contains full category paths with backslash separators (e.g. Malte\\Ausgaben\\Leben\\ErnÃ¤hrung), proving the hierarchy exists.\n\n## Root Cause  \nMoneyMoney's export categories plist has no children arrays. The _parse_category_tree() in applescript.py:228 handles children but there are none.\n\n## Solution\nReconstruct hierarchy from transaction category paths. Export transactions, collect unique category paths, build tree from backslash-separated paths. Map category UUIDs via categoryUuid field.\n\n## Impact\n- 106 categories shown flat with no hierarchy\n- Duplicate names (3x Sonstiges, 3x Nebenkosten, 2x Ausgaben) are indistinguishable\n- Cannot suggest proper categories for uncategorized transactions","status":"closed","priority":1,"issue_type":"bug","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T13:53:18.093472+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T14:01:09.47752+01:00","closed_at":"2026-01-26T14:01:09.47752+01:00","close_reason":"Closed"}
{"id":"mm-cli-ehu","title":"Balance history table output is garbled/unreadable","description":"## Problem\n\n`mm analyze balance-history` renders an unreadable table â€” columns appear as single-character-wide empty cells. The data is present (JSON output works fine), but the table rendering is broken.\n\n## Steps to Reproduce\n1. Run `mm analyze balance-history` â€” garbled table\n2. Run `mm analyze balance-history --format json` â€” works correctly\n3. Run `mm analyze balance-history --account Girokonto` â€” table renders fine for single account\n\nThe bug appears when displaying multiple accounts â€” the table tries to create too many columns or the layout logic doesn't handle the multi-account case properly.\n\n## Expected\nReadable table with columns for each month and rows per account (or similar layout).\n\n## Discovered during\nManual testing of mm-cli-gk5 (mm-cli-ty3 balance history tests)","status":"closed","priority":2,"issue_type":"bug","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T22:05:39.24843+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T22:15:33.674943+01:00","closed_at":"2026-01-26T22:15:33.674943+01:00","close_reason":"Closed"}
{"id":"mm-cli-ezy","title":"Implement core CLI commands for MoneyMoney interaction","description":"## Overview\nImplement the core CLI commands to interact with MoneyMoney macOS app via AppleScript. This is the foundation for all MoneyMoney data access.\n\n## Commands to Implement\n\n### 1. `mm accounts`\nList all accounts from MoneyMoney database.\n- AppleScript: `export accounts`\n- Returns: Account ID, name, balance, type, bank name\n- Output formats: table (default), json\n\n### 2. `mm transactions`\nList transactions with filtering options.\n- AppleScript: `export transactions from account ... from date ... to date ... as \"plist\"`\n- Options:\n  - `--account` / `-a`: Filter by account ID or name\n  - `--from` / `-f`: Start date (YYYY-MM-DD)\n  - `--to` / `-t`: End date (YYYY-MM-DD)  \n  - `--category` / `-c`: Filter by category\n  - `--uncategorized`: Show only uncategorized transactions\n- Output formats: table (default), json, csv\n\n### 3. `mm categories`\nList all categories from MoneyMoney.\n- AppleScript: `export categories`\n- Returns: Category UUID, name, parent category, type (income/expense)\n- Output formats: table (default), json\n\n### 4. `mm category-usage`\nShow categories sorted by transaction count.\n- Requires: transactions export + category mapping\n- Output: Category name, transaction count, total amount\n- Options:\n  - `--from` / `-f`: Start date\n  - `--to` / `-t`: End date\n  - `--limit` / `-n`: Top N categories\n\n### 5. `mm set-category`\nUpdate the category of a transaction.\n- AppleScript: `set transaction id [ID] category to [UUID]`\n- Arguments:\n  - `transaction_id`: Transaction ID (from plist export)\n  - `category`: Category name or UUID\n- Options:\n  - `--dry-run`: Show what would be changed without applying\n\n## Technical Implementation\n\n### AppleScript Module (`mm_cli/applescript.py`)\n- `run_applescript(script: str) -\u003e str`: Execute AppleScript via osascript\n- `export_accounts() -\u003e list[dict]`: Get all accounts\n- `export_transactions(...) -\u003e list[dict]`: Get transactions with filters\n- `export_categories() -\u003e list[dict]`: Get all categories\n- `set_transaction_category(tx_id: str, category_id: str) -\u003e bool`: Update category\n\n### Models (`mm_cli/models.py`)\n- `Account`: dataclass for account data\n- `Transaction`: dataclass for transaction data\n- `Category`: dataclass for category data\n\n### Output Formatting (`mm_cli/output.py`)\n- Rich tables for terminal output\n- JSON serialization\n- CSV export\n\n## Acceptance Criteria\n- [ ] All 5 commands implemented and working\n- [ ] Proper error handling for AppleScript failures\n- [ ] Rich formatted tables for human-readable output\n- [ ] JSON output option for machine processing\n- [ ] Unit tests with mocked AppleScript responses\n- [ ] `--help` documentation for all commands","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T14:04:05.745845+01:00","created_by":"malte","updated_at":"2026-01-06T14:14:32.841262+01:00","closed_at":"2026-01-06T14:14:32.841262+01:00","close_reason":"All 5 CLI commands implemented with full test coverage"}
{"id":"mm-cli-gk5","title":"Manual verification guide for implemented features","description":"Collects manual testing/verification steps for each implemented feature bead. Use this as a checklist when testing against real MoneyMoney app.","status":"closed","priority":1,"issue_type":"task","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T21:29:37.415286+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T22:11:41.858199+01:00","closed_at":"2026-01-26T22:11:41.858199+01:00","close_reason":"Closed","comments":[{"id":1,"issue_id":"mm-cli-gk5","author":"Malte Sussdorff","text":"## mm-cli-8oy: --group filter on transactions command\n\n### Manual Verification Steps\n1. Ensure MoneyMoney is running and unlocked\n2. Run: `mm transactions --group Privat` â€” should show only transactions from accounts in the 'Privat' group\n3. Run: `mm transactions --group cognovis` â€” should show only cognovis transactions\n4. Run: `mm transactions --group Privat --group cognovis` â€” should show transactions from both groups\n5. Run: `mm transactions --group privat` (lowercase) â€” should still work (case-insensitive)\n6. Run: `mm transactions --group NonExistent` â€” should show 'No transactions found' warning\n7. Run: `mm transactions` (without --group) â€” should work as before, showing all transactions\n8. Combine with other filters: `mm transactions --group Privat --from 2025-01-01 --to 2025-01-31`","created_at":"2026-01-26T20:31:48Z"},{"id":2,"issue_id":"mm-cli-gk5","author":"Malte Sussdorff","text":"## mm-cli-ty3: Balance history / trend per account\n\n### Manual Verification Steps\n1. Run: `mm analyze balance-history` â€” should show monthly balance snapshots for all accounts (default 6 months)\n2. Run: `mm analyze balance-history --months 12` â€” should show 12 months of history\n3. Run: `mm analyze balance-history --account Girokonto` â€” should show only that account's history\n4. Run: `mm analyze balance-history --group Privat` â€” should show only accounts in the Privat group\n5. Run: `mm analyze balance-history --format json` â€” should output JSON\n6. Verify balances look reasonable: the most recent month should be close to the current account balance\n7. Check that the trend direction makes sense (declining balances for expense-heavy accounts, etc.)","created_at":"2026-01-26T20:32:15Z"},{"id":3,"issue_id":"mm-cli-gk5","author":"Malte Sussdorff","text":"## mm-cli-1b4: Top customers analysis for cognovis income\n\n### Manual Verification Steps\n1. Run: `mm analyze top-customers` â€” should show income grouped by counterparty name\n2. Run: `mm analyze top-customers --group cognovis` â€” should filter to cognovis accounts only\n3. Run: `mm analyze top-customers --period this-year --limit 10` â€” top 10 customers this year\n4. Run: `mm analyze top-customers --format json` â€” should output JSON\n5. Verify totals: customer percentages should sum to ~100%\n6. Verify only income transactions are counted (positive amounts)\n7. Run with a group that has no income: should show appropriate warning","created_at":"2026-01-26T20:32:41Z"},{"id":4,"issue_id":"mm-cli-gk5","author":"Malte Sussdorff","text":"## mm-cli-s94: Top merchants analysis by spend\n\n### Manual Verification Steps\n1. Run: `mm analyze merchants` â€” should show top merchants by total spend\n2. Run: `mm analyze merchants --type income` â€” should show only income-generating merchants\n3. Run: `mm analyze merchants --type all` â€” should show both income and expense merchants\n4. Run: `mm analyze merchants --period this-year --limit 30` â€” top 30 merchants this year\n5. Run: `mm analyze merchants --group Privat` â€” filter to personal accounts\n6. Run: `mm analyze merchants --format json` â€” JSON output\n7. Verify merchant names are normalized (no duplicate entries for same merchant with different suffixes)\n8. Verify transaction counts and averages look reasonable","created_at":"2026-01-26T20:32:56Z"},{"id":5,"issue_id":"mm-cli-gk5","author":"Malte Sussdorff","text":"## mm-cli-iqv: Recurring transaction detection\n\n### Manual Verification Steps\n1. Run: `mm analyze recurring` â€” should detect subscriptions, standing orders, insurance payments\n2. Run: `mm analyze recurring --months 6 --min-occurrences 4` â€” stricter detection (must appear 4+ times in 6 months)\n3. Run: `mm analyze recurring --group Privat` â€” only personal recurring transactions\n4. Run: `mm analyze recurring --format json` â€” JSON output\n5. Verify detected items match known subscriptions (Netflix, Spotify, insurance, rent, etc.)\n6. Check frequency detection is correct (monthly vs quarterly vs annual)\n7. Verify annual cost estimates are reasonable (monthly amount * 12, quarterly * 4, etc.)\n8. Check that one-off transactions are NOT falsely detected as recurring","created_at":"2026-01-26T20:33:08Z"},{"id":6,"issue_id":"mm-cli-gk5","author":"Malte Sussdorff","text":"## mm-cli-kr0: Cashflow analysis (income vs expenses over time)\n\n### Manual Verification Steps\n1. Run: `mm analyze cashflow` â€” should show monthly income vs expenses for last 6 months\n2. Run: `mm analyze cashflow --months 12` â€” 12-month view\n3. Run: `mm analyze cashflow --period quarterly` â€” quarterly aggregation\n4. Run: `mm analyze cashflow --group Privat` â€” only personal accounts\n5. Run: `mm analyze cashflow --group cognovis` â€” only business accounts\n6. Run: `mm analyze cashflow --format json` â€” JSON output\n7. Verify: income column should be positive, expenses negative, net = income + expenses\n8. Verify: monthly totals should roughly match what you see in MoneyMoney\n9. Check that internal transfers are excluded (not double-counted)","created_at":"2026-01-26T20:33:18Z"},{"id":7,"issue_id":"mm-cli-gk5","author":"Malte Sussdorff","text":"## mm-cli-qpf: Add transfer command for bank transfers via MoneyMoney\n\n### Manual Verification Steps\n1. Run: `mm transfer --help` â€” verify all parameters shown (--from-account, --to, --iban, --amount, --purpose, --outbox, --dry-run, --confirm)\n2. Run: `mm transfer -f Girokonto -t 'Test Recipient' -i 'DE89370400440532013000' -a 1.00 -p 'Test purpose' --dry-run` â€” should show transfer summary but NOT execute\n3. Run: `mm transfer -f Girokonto -t 'Test Recipient' -i 'INVALID' -a 1.00 -p 'Test'` â€” should reject invalid IBAN\n4. Run: `mm transfer -f Girokonto -t 'Test Recipient' -i 'DE89370400440532013000' -a -5.00 -p 'Test'` â€” should reject negative amount\n5. Run: `mm transfer -f NonExistentAccount -t 'Test' -i 'DE89370400440532013000' -a 1.00 -p 'Test' --confirm` â€” should show account not found error\n6. Run a real transfer (small amount) with --confirm to verify it works end-to-end with MoneyMoney\n7. Run a real transfer with --outbox to verify it queues without opening the UI\n8. Verify IBAN with spaces is normalized: `mm transfer -f Girokonto -t 'Test' -i 'DE89 3704 0044 0532 0130 00' -a 1.00 -p 'Test' --dry-run`","created_at":"2026-01-26T20:36:04Z"},{"id":8,"issue_id":"mm-cli-gk5","author":"Malte Sussdorff","text":"## mm-cli-0kt: Portfolio command for investment/depot data\n\n### Manual Verification Steps\n1. Run: `mm portfolio` â€” should show all securities holdings across depot accounts\n2. Run: `mm portfolio --account Depot` â€” filter to a specific depot account (partial name match)\n3. Run: `mm portfolio --format json` â€” JSON output with security details\n4. Run: `mm portfolio --format csv` â€” CSV output\n5. Verify: security names, ISINs, quantities, and prices match what MoneyMoney shows\n6. Verify: gain/loss is correctly calculated (current_price - purchase_price) * quantity\n7. Verify: gain/loss percentage coloring (green=profit, red=loss)\n8. Verify: subtotals per account and grand total are correct\n9. If no depot accounts exist: should show 'No portfolio data' warning\n10. If depot account exists but has no securities: should show 'No securities found' warning","created_at":"2026-01-26T20:41:05Z"},{"id":9,"issue_id":"mm-cli-gk5","author":"Malte Sussdorff","text":"## mm-cli-n4w: Improved test coverage\n\n### Manual Verification Steps\nThis bead added unit tests only â€” no new CLI features. Verification is via the test suite:\n1. Run: `uv run pytest tests/ -v` â€” all 193 tests should pass\n2. Key areas now covered:\n   - set_transaction_checkmark() â€” on/off via AppleScript\n   - set_transaction_comment() â€” with quote escaping\n   - _extract_balance() â€” various formats including edge cases\n   - export command â€” csv, sta, ofx formats with date ranges\n   - suggest-rules CLI â€” end-to-end with mocked data\n   - Edge cases â€” empty results, null categories, unusual currencies, long text truncation","created_at":"2026-01-26T20:45:19Z"},{"id":10,"issue_id":"mm-cli-gk5","author":"Malte Sussdorff","text":"## mm-cli-t41: CLI commands for set-checkmark and set-comment\n\n### Manual Verification Steps\n1. First get a transaction ID: `mm transactions --format json | jq '.[0].id'`\n2. Run: `mm set-checkmark \u003ctx-id\u003e on` â€” should mark transaction as checked in MoneyMoney\n3. Verify in MoneyMoney UI that the checkmark appears\n4. Run: `mm set-checkmark \u003ctx-id\u003e off` â€” should remove the checkmark\n5. Verify in MoneyMoney UI that the checkmark is gone\n6. Run: `mm set-checkmark \u003ctx-id\u003e maybe` â€” should show 'Invalid state' error\n7. Run: `mm set-comment \u003ctx-id\u003e 'Test comment from CLI'` â€” should add a comment\n8. Verify in MoneyMoney UI that the comment appears on the transaction\n9. Run: `mm set-comment \u003ctx-id\u003e ''` â€” should clear the comment\n10. Verify in MoneyMoney UI that the comment is removed","created_at":"2026-01-26T20:47:10Z"},{"id":11,"issue_id":"mm-cli-gk5","author":"Malte Sussdorff","text":"## mm-cli-h6x: Extended transaction filtering (amount, sorting, checkmark)\n\n### Manual Verification Steps\n1. Run: `mm transactions --min-amount 100` â€” should show only transactions \u003e= 100 EUR (by absolute value)\n2. Run: `mm transactions --max-amount 50` â€” should show only transactions \u003c= 50 EUR\n3. Run: `mm transactions --min-amount 10 --max-amount 100` â€” range filter\n4. Run: `mm transactions --sort date` â€” should sort by date ascending (oldest first)\n5. Run: `mm transactions --sort date --reverse` â€” newest first\n6. Run: `mm transactions --sort amount` â€” biggest amounts first (default for amount)\n7. Run: `mm transactions --sort amount --reverse` â€” smallest amounts first\n8. Run: `mm transactions --sort name` â€” alphabetical by transaction name\n9. Run: `mm transactions --checkmark on` â€” only checked transactions\n10. Run: `mm transactions --checkmark off` â€” only unchecked transactions\n11. Combine filters: `mm transactions --group Privat --min-amount 50 --sort amount --checkmark off`\n12. Invalid values: `mm transactions --sort invalid` and `mm transactions --checkmark maybe` â€” should show validation errors","created_at":"2026-01-26T20:49:11Z"},{"id":12,"issue_id":"mm-cli-gk5","author":"Malte Sussdorff","text":"## Manual Testing Results (2026-01-26)\n\n### Passed\n- **Unit tests (mm-cli-n4w):** 211/211 pass\n- **--group filter (mm-cli-8oy):** Works with date range. Privat, cognovis, multi-group, case-insensitive all work. Non-existent group returns empty.\n- **Extended filters (mm-cli-h6x):** --min-amount, --max-amount, --sort (date/amount/name), --reverse, --checkmark on/off all work. Validation errors for invalid sort/checkmark values correct.\n- **set-comment (mm-cli-t41):** Set, verified, cleared, re-set. All work.\n- **set-checkmark (mm-cli-t41):** On, verified, off, re-set. Invalid state ('maybe') rejected correctly.\n- **analyze cashflow (mm-cli-kr0):** Default, --months 12, --group Privat, --format json all work.\n- **analyze top-customers (mm-cli-1b4):** Default and --group cognovis work.\n- **analyze merchants (mm-cli-s94):** Default, --type income, --type all work.\n- **analyze recurring (mm-cli-iqv):** Default, --group Privat, --format json work.\n- **analyze balance-history (mm-cli-ty3):** --account and --format json work. Table output garbled (see issues).\n- **transfer dry-run (mm-cli-qpf):** Dry-run works. IBAN with spaces normalized correctly. Invalid IBAN, negative amount, non-existent account all rejected correctly.\n\n### Issues Found\n1. **mm-cli-dt0 (created):** `mm transactions` without --from/--to fails. MoneyMoney requires date range. Adding --days with 14-day default.\n2. **Portfolio broken:** `mm portfolio` fails with 'Einige Parameter fehlen fÃ¼r export portfolio' (-1701). Even with --account filter. Needs investigation.\n3. **balance-history table garbled:** Table format renders as empty cells. JSON format works fine. Display/rendering bug.","created_at":"2026-01-26T21:04:58Z"},{"id":13,"issue_id":"mm-cli-gk5","author":"Malte Sussdorff","text":"## Status Update: Closing after initial test pass\n\n### Completed tests (all passed):\n- âœ… mm-cli-n4w: Unit tests (211/211)\n- âœ… mm-cli-8oy: --group filter (with date range workaround)\n- âœ… mm-cli-h6x: Extended filters (amount, sort, checkmark, validation)\n- âœ… mm-cli-t41: set-checkmark and set-comment (full cycle)\n- âœ… mm-cli-1b4: Top customers (default + group filter)\n- âœ… mm-cli-s94: Merchants (default, --type income, --type all)\n- âœ… mm-cli-iqv: Recurring detection (default, --group, --format json)\n- âœ… mm-cli-kr0: Cashflow (default, --months 12, --group, --format json)\n- âœ… mm-cli-qpf: Transfer (dry-run, IBAN normalization, all validations)\n\n### Tests to re-do after bugfixes:\n- ðŸ”„ mm-cli-8oy: Re-test --group filter WITHOUT date range (after mm-cli-dt0 adds --days default)\n- ðŸ”„ mm-cli-8oy: Re-test `mm transactions` with no arguments (after mm-cli-dt0)\n- ðŸ”„ mm-cli-0kt: Re-test all portfolio tests (after mm-cli-s86 fix)\n- ðŸ”„ mm-cli-ty3: Re-test balance-history table output for multi-account (after mm-cli-ehu fix)","created_at":"2026-01-26T21:11:38Z"}]}
{"id":"mm-cli-h6x","title":"Extend transaction filtering: amount range, sorting, checkmark status","description":"Add --min-amount, --max-amount, --sort (date|amount|name), --reverse, and --checkmark filter to the transactions command. Useful for budget analysis (Privat accounts) and reconciliation workflows.","status":"closed","priority":3,"issue_type":"feature","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T15:00:38.505068+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T21:49:11.460097+01:00","closed_at":"2026-01-26T21:49:11.460097+01:00","close_reason":"Implemented: --min-amount, --max-amount, --sort (date|amount|name), --reverse, --checkmark filters with validation and 10 tests."}
{"id":"mm-cli-iqv","title":"Recurring transaction detection","description":"New 'mm analyze recurring' command that detects recurring transactions by merchant name pattern, similar amounts, and monthly cadence. Shows subscriptions, standing orders, insurance payments. Helps find forgotten subscriptions. Groups by normalized merchant name, shows frequency, average amount, last occurrence, and total annual cost.","status":"closed","priority":2,"issue_type":"feature","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T18:02:01.874841+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T21:33:08.204354+01:00","closed_at":"2026-01-26T21:33:08.204354+01:00","close_reason":"Already fully implemented: CLI command, analysis function, output function, and tests all present."}
{"id":"mm-cli-kr0","title":"Cashflow analysis: income vs expenses over time","description":"New 'mm analyze cashflow' command showing monthly or quarterly income vs expenses trend over a configurable period (default last 6 months). Table output with month rows, income/expense/net columns. Optionally filterable by --group. Useful for spotting accumulation vs burn trends across all account groups.","status":"closed","priority":2,"issue_type":"feature","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T18:01:47.833794+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T21:33:18.476592+01:00","closed_at":"2026-01-26T21:33:18.476592+01:00","close_reason":"Already fully implemented: CLI command, analysis function, output function, and tests all present."}
{"id":"mm-cli-kuo","title":"Cross-validate analyze command outputs against raw transaction data","description":"## Goal\n\nVerify that the aggregated outputs from analyze commands match the underlying raw transaction data. This ensures the aggregation logic is correct, not just that commands run without errors.\n\n## Test Plan\n\n### 1. Cashflow vs raw transactions (thorough)\nFor multiple months (at least 3) and multiple groupings:\n- Fetch all transactions for a given month as JSON\n- Sum income (positive amounts) and expenses (negative amounts) via jq\n- Compare against `mm analyze cashflow` output for that month\n- Test combinations:\n  - All accounts (no filter)\n  - `--group Privat`\n  - `--group cognovis`\n  - At least 2 different month ranges\n\nTolerance: exact match expected (same data source).\n\n### 2. Recurring detection spot-check\nVerify known recurring transactions are detected correctly:\n- **Cognovis salary** (monthly income) â€” check amount and frequency\n- **Apple payments** (monthly subscription) â€” check amount and frequency  \n- **Private â†’ DKB Haushalt transfers** â€” check detection and frequency\n- For each: filter raw transactions by name, count occurrences, compare avg amount against what `analyze recurring` reports\n\n### 3. Top customers spot-check\nPick 2-3 customers from `analyze top-customers` output:\n- Filter raw transactions by that customer name\n- Sum income amounts\n- Compare against reported total and transaction count\n\n### 4. Merchants spot-check\nPick 2-3 merchants from `analyze merchants` output:\n- Filter raw transactions by merchant name\n- Sum amounts\n- Compare against reported total, avg, and transaction count\n\n## Discovered during\nManual testing session for mm-cli-gk5","status":"closed","priority":1,"issue_type":"task","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T22:09:39.529379+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T22:45:17.741342+01:00","closed_at":"2026-01-26T22:45:17.741342+01:00","close_reason":"All checks passed. Cross-group salary transfers verified: --group Privat shows 'Cognovis GmbH' (15 txs), --group cognovis shows 'Malte Sussdorff' (14 txs) â€” both correctly kept as cross-group transfers. Without group filter, both excluded. Different names/counts are expected: each bank side records the counterparty name. No bugs found in aggregation logic."}
{"id":"mm-cli-n4w","title":"Improve test coverage for untested functions","description":"Several implemented functions lack tests: set_transaction_checkmark(), set_transaction_comment(), _extract_balance(), export command with various formats, suggest-rules CLI command integration test, edge cases (empty results, null values, unusual currencies). Add tests to improve maintainability.","status":"closed","priority":3,"issue_type":"task","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T15:00:56.967816+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T21:45:19.286542+01:00","closed_at":"2026-01-26T21:45:19.286542+01:00","close_reason":"Added 37 new tests covering previously untested functions: checkmark, comment, balance extraction, export, suggest-rules, and edge cases."}
{"id":"mm-cli-obm","title":"Add account groups/hierarchy to accounts command","description":"## Problem\nmm accounts skips account groups (applescript.py:190). MoneyMoney organizes accounts into groups (Haushalt, Privat, cognovis, AufgelÃ¶st, FlyHH) but this structure is lost.\n\n## Requirements\n- Show account groups in table output (indented or grouped)\n- Add --include-groups or --show-groups flag  \n- Add --active flag to filter out zero-balance/closed accounts (AufgelÃ¶st group)\n- JSON output should include group name as field\n- Consider --group filter flag\n\n## Known Groups\nHaushalt: DKB Haushalt\nPrivat: Haus, Tagesgeld, Privat, Flatex, AMEX Malte, MLP Kreditkarte\ncognovis: Postbank, Fyrst Base, CapTrader, AMEX Business Gold, PayPal\nAufgelÃ¶st: Penta, Smartbroker, old cards\nFlyHH: Fidor, old Postbank, old cards, AirBnB, Instandhaltung","notes":"## Implementierungsplan\n\nZiel: mm accounts zeigt Account-Gruppen. Default: flache Liste + Group-Spalte. --hierarchy fuer gruppierte Anzeige mit Section Headers/Subtotals.\n\nAenderungen:\n1. applescript.py: Gruppen-Tracking statt skip. Gruppenname an Child-Accounts propagieren. Bugfix: Account.group war bool statt str.\n2. cli.py: Neue Flags --hierarchy, --active (filtert Aufgeloest), --group TEXT (wiederholbar).\n3. output.py: Default-Tabelle mit Group-Spalte. Hierarchy-Mode: Section Headers (bold) + Subtotals pro Gruppe.\n\nReihenfolge: Dieses Ticket ZUERST (Dependency fuer mm-cli-5vw Spending --group Filter).\n\nVerifikation: mm accounts / --hierarchy / --active / --group Privat / --group Privat --group Haushalt / --format json","status":"closed","priority":2,"issue_type":"task","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T13:53:24.1056+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T18:00:58.041251+01:00","closed_at":"2026-01-26T18:00:58.041251+01:00","close_reason":"Implemented: account groups with --hierarchy, --active, --group flags"}
{"id":"mm-cli-qpf","title":"Add transfer command for bank transfers via MoneyMoney","description":"Add 'mm transfer' command to create SEPA bank transfers through MoneyMoney's AppleScript API. Use case: quickly pay scanned invoices from the CLI. Parameters: --from-account, --to (recipient), --iban, --amount, --purpose. Safety: require --confirm flag or interactive confirmation, add --dry-run, validate IBAN format. AppleScript: 'create bank transfer from account ... to ... iban ... amount ... purpose ...'. Supports --outbox to queue without opening UI.","status":"closed","priority":3,"issue_type":"feature","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T15:04:43.199986+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T21:36:04.386735+01:00","closed_at":"2026-01-26T21:36:04.386735+01:00","close_reason":"Implemented: transfer command with dry-run, confirm, outbox, IBAN validation, account lookup."}
{"id":"mm-cli-s86","title":"Portfolio command fails with missing parameters error","description":"## Problem\n\n`mm portfolio` fails with AppleScript error: 'Einige Parameter fehlen fÃ¼r export portfolio' (-1701). This happens with and without the `--account` filter. The `--format json` variant also fails.\n\nThe AppleScript call to MoneyMoney's `export portfolio` is missing required parameters.\n\n## Steps to Reproduce\n1. Run `mm portfolio`\n2. Run `mm portfolio --account 'Flatex Depotkonto'`\n3. Run `mm portfolio --format json`\n\nAll fail with the same error.\n\n## Expected\nShould display securities holdings from depot/investment accounts.\n\n## Discovered during\nManual testing of mm-cli-gk5 (mm-cli-0kt portfolio tests)","status":"closed","priority":1,"issue_type":"bug","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T22:05:38.043716+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T22:15:33.610483+01:00","closed_at":"2026-01-26T22:15:33.610483+01:00","close_reason":"Closed"}
{"id":"mm-cli-s94","title":"Top merchants analysis by spend","description":"New 'mm analyze merchants' command showing top N merchants/counterparties by total spend. Groups by transaction name (normalized) instead of category. Answers 'where does the money actually go?' before categorization. Supports --type income/expense, --group, --period filters. Complements existing category-usage command.","status":"closed","priority":2,"issue_type":"feature","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T18:02:03.280437+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T21:32:57.000952+01:00","closed_at":"2026-01-26T21:32:57.000952+01:00","close_reason":"Already fully implemented: CLI command, analysis function, output function, and tests all present."}
{"id":"mm-cli-t41","title":"Add CLI commands for set-checkmark and set-comment","description":"The AppleScript functions set_transaction_checkmark() and set_transaction_comment() exist in applescript.py but have no CLI wrappers. Add 'mm set-checkmark \u003ctx-id\u003e [on|off]' and 'mm set-comment \u003ctx-id\u003e \u003ctext\u003e' commands. Useful for reconciliation marking and annotation workflows.","status":"closed","priority":3,"issue_type":"feature","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T15:00:44.576379+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T21:47:10.458922+01:00","closed_at":"2026-01-26T21:47:10.458922+01:00","close_reason":"Implemented: set-checkmark (on/off) and set-comment CLI commands with validation and 5 tests."}
{"id":"mm-cli-ty3","title":"Balance history / trend per account","description":"New 'mm analyze balance-history' command showing account balance trajectory over time. Approximates historical balances by working backwards from current balance using transactions. Shows monthly balance snapshots per account or per group. Useful for liquidity trend visualization. Supports --group, --account, --months filters.","status":"closed","priority":2,"issue_type":"feature","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T18:02:07.271488+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T21:32:22.700918+01:00","closed_at":"2026-01-26T21:32:22.700918+01:00","close_reason":"Already fully implemented: CLI command, analysis function, output function, and tests all present."}
{"id":"mm-cli-wk8","title":"Add suggest-rules command for MoneyMoney auto-categorization analysis","description":"## Context\nMoneyMoney has NO AppleScript API for reading or managing rules as separate entities (confirmed via .sdef scripting dictionary). HOWEVER, the export categories plist DOES include a 'rules' field on each category containing the MoneyMoney rule text. This is now parsed and available in mm-cli via the Category.rules field.\n\n## What's Already Available (after mm-cli-dyg fix)\n- Category.rules: The MoneyMoney rule text for each category\n- Category.path: Full hierarchical path (e.g. Malte\\Ausgaben\\Leben\\ErnÃ¤hrung)\n- Category.indentation: Nesting level\n- Category.group: Whether it's a group/folder\n- mm categories --format json: Full data including rules\n\n## Feature: mm suggest-rules\nAnalyze transaction data to suggest NEW MoneyMoney rules:\n1. Find uncategorized transactions, match against patterns from categorized ones\n2. Suggest rules based on recurring payee patterns\n3. Compare against existing rules to avoid duplicates\n4. Detect PayPal + direct merchant duplicates (same amount, same date)\n\n## Output Example\nPattern                        | Category      | Matches | Existing Rule?\nName contains Apple.com.Bill   | Subscriptions | 4       | Partial (Apple.com/Bill in Sonstige Unterhaltung)\nName contains Versicherung     | Versicherung  | 4       | No\n\n## Implementation\n- Use export_transactions() for transaction data\n- Use export_categories() for existing rules\n- Build payee-\u003ecategory mapping from categorized transactions\n- Compare suggested rules against existing Category.rules\n- Apply fuzzy matching (normalize PayPal names, strip location suffixes)\n- Use historical data for better matching","status":"closed","priority":2,"issue_type":"feature","owner":"malte.sussdorff@cognovis.de","created_at":"2026-01-26T13:53:30.084484+01:00","created_by":"Malte Sussdorff","updated_at":"2026-01-26T14:09:51.107943+01:00","closed_at":"2026-01-26T14:09:51.107943+01:00","close_reason":"Closed","dependencies":[{"issue_id":"mm-cli-wk8","depends_on_id":"mm-cli-dyg","type":"blocks","created_at":"2026-01-26T13:54:06.612269+01:00","created_by":"Malte Sussdorff"}]}
